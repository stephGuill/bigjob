<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscription - La Plateforme_</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                 <img src="assets/img/Détour_logo_laplateforme02.png" alt="Logo Laplateforme" class="logo-img" />
                 La Plateforme_
            </a>
        </div>
    </nav>

    <div class="container">
        <div class="row justify-content-center align-items-center min-vh-100">
            <div class="col-md-6 col-lg-5">
                <div class="card shadow-lg">
                    <div class="card-body p-5">
                        <h2 class="card-title text-center mb-4">
                            <i class="bi bi-person-plus"></i> Inscription
                        </h2>
                        
                        <div id="registerAlert" class="alert d-none" role="alert"></div>

                        <form id="registerForm" onsubmit="handleRegister(event)">
                            <div class="mb-3">
                                <label for="registerName" class="form-label">Nom complet</label>
                                <input type="text" class="form-control" id="registerName" required>
                            </div>
                            <div class="mb-3">
                                <label for="registerEmail" class="form-label">Email</label>
                                <input type="email" class="form-control" id="registerEmail" required>
                                <div class="form-text">
                                    <i class="bi bi-info-circle"></i> Seuls les emails @laplateforme.io sont autorisés
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="registerPassword" class="form-label">Mot de passe</label>
                                <input type="password" class="form-control" id="registerPassword" required>
                            </div>
                            <div class="mb-3">
                                <label for="registerConfirmPassword" class="form-label">Confirmer le mot de passe</label>
                                <input type="password" class="form-control" id="registerConfirmPassword" required>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="bi bi-person-plus"></i> S'inscrire
                                </button>
                            </div>
                        </form>

                        <hr class="my-4">
                        
                        <div class="text-center">
                            <p class="mb-0">Déjà un compte ?</p>
                            <a href="login.html" class="btn btn-link">Se connecter</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // Initialiser les données par défaut
    function initDefaultData() {
        if (!localStorage.getItem('users')) {
            const defaultUsers = [
                {
                    id: 1,
                    name: "Admin User",
                    email: "admin@laplateforme.io",
                    password: "admin123",
                    role: "admin"
                },
                {
                    id: 2,
                    name: "Moderator User",
                    email: "moderator@laplateforme.io",
                    password: "modo123",
                    role: "moderator"
                },
                {
                    id: 3,
                    name: "Jean Dupont",
                    email: "jean.dupont@laplateforme.io",
                    password: "user123",
                    role: "user"
                }
            ];
            localStorage.setItem('users', JSON.stringify(defaultUsers));
        }

        if (!localStorage.getItem('reservations')) {
            localStorage.setItem('reservations', JSON.stringify([]));
        }
    }

    // Fonction pour afficher les alertes
    function showAlert(message, type) {
        const alert = document.getElementById('registerAlert');
        alert.classList.remove('d-none', 'alert-success', 'alert-danger', 'alert-warning');
        alert.classList.add('alert-' + type);
        alert.textContent = message;
        
        setTimeout(() => {
            alert.classList.add('d-none');
        }, 5000);
    }

    // Vérifier si déjà connecté
    function checkAuth() {
        const currentUser = sessionStorage.getItem('currentUser');
        if (currentUser) {
            window.location.href = 'calendar.html';
        }
    }

    // Gérer l'inscription
    function handleRegister(event) {
        event.preventDefault();
        
        const name = document.getElementById('registerName').value.trim();
        const email = document.getElementById('registerEmail').value.trim();
        const password = document.getElementById('registerPassword').value;
        const confirmPassword = document.getElementById('registerConfirmPassword').value;

        // Vérifications
        if (!name || !email || !password) {
            showAlert('Tous les champs sont requis', 'danger');
            return;
        }

        if (password !== confirmPassword) {
            showAlert('Les mots de passe ne correspondent pas', 'danger');
            return;
        }

        if (password.length < 6) {
            showAlert('Le mot de passe doit contenir au moins 6 caractères', 'danger');
            return;
        }

        if (!email.endsWith('@laplateforme.io')) {
            showAlert('Seuls les emails @laplateforme.io sont autorisés', 'danger');
            return;
        }

        // Récupérer les utilisateurs existants
        const users = JSON.parse(localStorage.getItem('users') || '[]');

        // Vérifier si l'email existe déjà
        if (users.find(u => u.email === email)) {
            showAlert('Cet email est déjà utilisé', 'danger');
            return;
        }

        // Créer le nouvel utilisateur
        const newUser = {
            id: users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1,
            name: name,
            email: email,
            password: password,
            role: 'user'
        };

        // Ajouter l'utilisateur
        users.push(newUser);
        localStorage.setItem('users', JSON.stringify(users));

        // Connecter l'utilisateur
        sessionStorage.setItem('currentUser', JSON.stringify(newUser));

        // Afficher le succès et rediriger
        showAlert('Inscription réussie ! Redirection...', 'success');
        setTimeout(() => {
            window.location.href = 'calendar.html';
        }, 1500);
    }

    // Initialiser au chargement de la page
    window.onload = function() {
        initDefaultData();
        checkAuth();
    };
    </script>
</body>
</html>
